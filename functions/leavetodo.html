<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
	<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
	<title>title</title>
	<link rel="stylesheet" type="text/css" href="../css/api.css" />
	<link rel="stylesheet" type="text/css" href="../css/style.css" />
	<style>
		.h-right {
			text-align: right;
			margin-right: 0.23rem;
			-webkit-flex: 0.3;
			/* Chrome */
			-ms-flex: 0.3;
			/* IE 10 */
			flex: 0.3;
			/* NEW, Spec - Opera 12.1, Firefox 20+ */
			-webkit-box-flex: 0.3;
			/* OLD - iOS 6-, Safari 3.1-6 */
			-moz-box-flex: 0.3;
		}

		.h-left {
			width: 0%;
			margin-left: 0.23rem;
			text-align: left;
			-webkit-flex: 0.3;
			/* Chrome */
			-ms-flex: 0.3;
			/* IE 10 */
			flex: 0.3;
			/* NEW, Spec - Opera 12.1, Firefox 20+ */
			-webkit-box-flex: 0.3;
			/* OLD - iOS 6-, Safari 3.1-6 */
			-moz-box-flex: 0.3;
		}

		.h-left img {
			margin-top: 0.215rem;
			width: 0.25rem;
			height: 0.45rem;
			background: url(../image/setting/icon-back.png);
			background-size: cover;
			margin-left: 0;
		}
		/****************************************************************************************************************/

		.setbox {
			background: #ffffff;
			height: 0.88rem;
			line-height: 0.88rem;
			display: -webkit-flex;
			/* 新版本语法: Chrome 21+ */
			display: flex;
			/* 新版本语法: Opera 12.1, Firefox 22+ */
			display: -webkit-box;
			/* 老版本语法: Safari, iOS, Android browser, older           WebKit browsers. */
			display: -moz-box;
			/* 老版本语法: Firefox (buggy) */
			display: -ms-flexbox;
			/* 混合版本语法: IE 10 */
		}

		.setleft {
			display: block;
			margin-left: 0.27rem;
			line-height: 0.88rem;
			text-align: left;
			color: #333333;
			font-size: 0.28rem;
		}

		.setcon {
			text-align: right;
			margin-left: 0.2rem;
			color: #666666;
			font-size: 0.26rem;
			-webkit-flex: 1;
			/* Chrome */
			-ms-flex: 1;
			/* IE 10 */
			flex: 1;
			/* NEW, Spec - Opera 12.1, Firefox 20+ */
			-webkit-box-flex: 1;
			/* OLD - iOS 6-, Safari 3.1-6 */
			-moz-box-flex: 1;
			margin-right: 0.23rem;
		}

		.setright {
			width: 0.16rem;
			height: 0.28rem;
			margin-right: 0.23rem;
			background: url(../image/setting/icon-todo.png);
			background-size: cover;
			margin-top: 0.3rem;
			display: none;
		}

		.sp {
			height: 0;
			width: 0;
		}

		.dp {
			margin-top: 0.77rem;
		}

		.line {
			margin-left: 0.23rem;
			position: relative;
		}

		.line:after {
			border-bottom: 1px solid #d9d9d9;
			content: "";
			display: block;
			position: absolute;
			bottom: 0;
			left: 0;
			right: 0;
			-webkit-transform-origin: 0 0;
			-webkit-transform: scaleY(0.5);
		}

		.start {
			position: relative;
		}

		.start:after {
			border-bottom: 1px solid #cccccc;
			content: "";
			display: block;
			position: absolute;
			bottom: 0;
			left: 0;
			right: 0;
			-webkit-transform-origin: 0 0;
			-webkit-transform: scaleY(0.5);
		}

		.person {
			height: 1.23rem;
			line-height: 1.23rem;
		}

		.perleft {
			text-align: left;
			-webkit-flex: 1;
			/* Chrome */
			-ms-flex: 1;
			/* IE 10 */
			flex: 1;
			/* NEW, Spec - Opera 12.1, Firefox 20+ */
			-webkit-box-flex: 1;
			/* OLD - iOS 6-, Safari 3.1-6 */
			-moz-box-flex: 1;
		}

		.per {
			display: -webkit-flex;
			/* 新版本语法: Chrome 21+ */
			display: flex;
			/* 新版本语法: Opera 12.1, Firefox 22+ */
			display: -webkit-box;
			/* 老版本语法: Safari, iOS, Android browser, older           WebKit browsers. */
			display: -moz-box;
			/* 老版本语法: Firefox (buggy) */
			display: -ms-flexbox;
			/* 混合版本语法: IE 10 */
			overflow: hidden;
			display: block;
		}

		.hicp {
			float: right;
			height: 0.90rem;
			width: 0.9rem;
			border-radius: 50%;
			background: url(../image/setting/icon-icon.png);
			background-size: cover;
			margin-top: 0.19rem;
		}

		.school {
			color: #666666;
			font-size: 0.26rem;
			margin-left: 0.23rem;
		}

		.endtab {
			position: fixed;
			bottom: 0;
			height: 0.98rem;
			background: #cccccc;
			border-top-color: #EEEEEE;
			text-align: center;
			line-height: 0.98rem;
			width: 100%;
			border-top: #EEEEEE solid 0.01rem;
			margin-bottom: 0;
			color: #FFFFFF;
			font-size: 0.32rem;
		}

		.hid {
			display: none;
		}

		.txtleft {
			text-align: left;
		}

		.fontcolor {
			color: #FF8344;
		}

		.fontcolor_1 {
			color: #1EBEB6;
		}

		.todo {
			border: 1px dashed #efefef;
			height: 0.44rem;
			display: inline-block;
			overflow: hidden;
			line-height: 0.44rem;
			margin-top: 0.22rem;
			color: #ff8344;
			padding: 0rem 0.1rem 0 0.1rem;
		}

		#maclass {
			display: none;
		}

		#ticlass {
			display: none;
		}

		.mark {
			overflow: hidden;
		}
	</style>
</head>

<body>
	<div class="flex-wrap flex-vertical"></div>
</body>
<script type="template" id="dotTmpl">
	<header>
		<div class="h-left" onclick="closeWin();"><img src="../image/setting/icon-back.png" /></div>
		<div class="h-conter">
			{{=it[0].title}}
		</div>
		<div class="h-right"></div>
	</header>
	<div class="flex-con">
		<div class="setbox person">
			<div class="setleft person">头像</div>
			<div class="setcon per">
				<div class="hicp"></div>
			</div>
			<div class="setright dp"></div>
		</div>
		<div class="start"></div>
		<div class="setbox">
			<div class="setleft general">姓名：</div>
			<div class="setcon">{{=it[0].name}}</div>
			<div class="setright sp"></div>
		</div>
		<div class="line"></div>
		<div class="setbox callphone">
			<div class="setleft about">家长电话：</div>
			<div class="setcon fontcolor_1">{{=it[0].tel}}</div>
			<div class="setright sp"></div>
		</div>
		<div class="line"></div>
		<div class="setbox">
			<div class="setleft about ">请假班级：</div>
			<div class="setcon txtleft">{{=it[0].cls}}</div>
			<div class="setright"></div>
		</div>
		<div class="line"></div>
		<div class="setbox">
			<div class="setleft about">请假课时：</div>
			<div class="setcon txtleft">{{=it[0].lesson}}</div>
			<div class="setright"></div>
		</div>
		<div class="line"></div>
		<div class="setbox">
			<div class="setleft about">请假原因：</div>
			<div class="setcon txtleft">{{=it[0].reason}}</div>
			<div class="setright"></div>
		</div>
		<div class="line"></div>
		<div class="setbox">
			<div class="setleft about">请假备注：</div>
			<div class="setcon txtleft mark">{{=it[0].remark}}</div>
			<div class="setright"></div>
		</div>
		<div class="line"></div>
		<div class="setbox" onclick="set(1)">
			<div class="setleft about">处理意见：</div>
			<div class="setcon txtleft todo" id='tk'>{{=it[0].suggestion}}</div>
			<div class="setright"></div>
		</div>
		<div class="line"></div>
		<div class="setbox" id='maclass' onclick="set(2)">
			<div class="setleft about">补课班级：</div>
			<div class="setcon txtleft todo" id='tk2'>{{=it[0].makeup}}</div>
			<div class="setright"></div>
		</div>
		<div class="line"></div>
		<div class="setbox" id='ticlass' onclick="set(3)">
			<div class="setleft about">补课时间：</div>
			<div class="setcon txtleft todo " id='tk3'>{{=it[0].time}}</div>
			<div class="setright"></div>
		</div>
		<div class="endtab">确认</div>
	</div>
</script>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/doT.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript">
	var tk;
	var info;
	var tittle;
	var imageUrl;
	var isone = true;
	var isSelectTime = true;
	var TimeId = [];
	var inClassId = [];

	function set(tag) {
		switch (tag) {
			case 1:
				if (info.stute == 0) {
					api.actionSheet({
						cancelTitle: "取消",
						buttons: tk
					}, function(ret, err) {
						var index = ret.buttonIndex;
						if (index == 1) {
							$api.text($api.dom('#tk'), "调课");
							$api.css($api.dom('#maclass'),
								'display:  display: -webkit-flex; display: flex;  display: -webkit-box;   /* 老版本语法: Safari, iOS, Android browser, older  WebKit browsers. */ display: -moz-box; /* 老版本语法: Firefox (buggy) display: -ms-flexbox;   /* 混合版本语法: IE 10 */   ');
							$api.css($api.dom('#ticlass'),
								'display:  display: -webkit-flex; display: flex;  display: -webkit-box;   /* 老版本语法: Safari, iOS, Android browser, older  WebKit browsers. */ display: -moz-box; /* 老版本语法: Firefox (buggy) display: -ms-flexbox;   /* 混合版本语法: IE 10 */   ');
							$api.css($api.dom('.endtab'), 'background: #cccccc;');
							if (isone) {
								moveLesson()
							}
							isone = false;
						} else if (index == 2) {
							$api.text($api.dom('#tk'), "直接销课");
							$api.css($api.dom('#maclass'), 'display:none');
							$api.css($api.dom('#ticlass'), 'display:none');
							$api.css($api.dom('.endtab'), 'background: #ff8344;');
							$api.addEvt($api.dom('.endtab'), 'click', function() {
								api.confirm({
									title: '提示',
									msg: '申请一经确认，即时生效，确认操作？',
									buttons: ['确定', '取消']
								}, function(ret, err) {
									if (ret) {
										var index = ret.buttonIndex;
										if (index === 1) {
											var data = {};
											data.method = "saveNewClasstimetable";
											data.request = {
												"id": api.pageParam.needid,
												"teacherId": api.getPrefs({
													sync: true,
													key: 'userid'
												}),
												"newClassId": 0,
												"newClassTimetableId": 0,
												"teacherOpinion": 1,
												"leaveType": 0
											}, api.showProgress();
											console.log("请假处理直接销课saveNewClasstimetable请求数据：" + JSON.stringify(data));
											ajaxRequest(data, function(ret, err) {
												api.hideProgress();
												if (ret) {
													console.log("请假处理直接销课saveNewClasstimetable成功返回数据：" + JSON.stringify(ret));
													if (ret.responseBody) {
														alert("恭喜，提交成功！");
														closeWin()

													} else {
														alert("提交失败，请稍后重试！");
														closeWin()

													}

												} else {
													console.log("请假处理直接销课saveNewClasstimetable失败返回数据：" + JSON.stringify(err));
													alert("提交失败，请稍后重试！");
													closeWin()
												}
											})
										}
									} else {
										alert(JSON.stringify(err));
									}
								});



							})

						} else if (index == 3) {
							$api.text($api.dom('#tk'), "保留课次");
							$api.css($api.dom('#maclass'), 'display:none');
							$api.css($api.dom('#ticlass'), 'display:none');
							$api.css($api.dom('.endtab'), 'background: #ff8344;');
							$api.addEvt($api.dom('.endtab'), 'click', function() {
								api.confirm({
									title: '提示',
									msg: '申请一经确认，即时生效，确认操作？',
									buttons: ['确定', '取消']
								}, function(ret, err) {
									if (ret) {
										var index = ret.buttonIndex;
										if (index === 1) {
											var data = {};
											data.method = "saveNewClasstimetable";
											data.request = {
												"id": api.pageParam.needid,
												"teacherId": api.getPrefs({
													sync: true,
													key: 'userid'
												}),
												"newClassId": 0,
												"newClassTimetableId": 0,
												"teacherOpinion": 2,
												"leaveType": 0
											}, api.showProgress();
											console.log("请假处理直接销课saveNewClasstimetable请求数据：" + JSON.stringify(data));
											ajaxRequest(data, function(ret, err) {
												api.hideProgress();
												if (ret) {
													console.log("请假处理直接销课saveNewClasstimetable成功返回数据：" + JSON.stringify(ret));
													if (ret.responseBody) {
														alert("恭喜，提交成功！");
														closeWin()
													} else {
														alert("提交失败，请稍后重试！");
														closeWin()

													}
												} else {
													console.log("请假处理直接销课saveNewClasstimetable失败返回数据：" + JSON.stringify(err));
													alert("提交失败，请稍后重试！");
													closeWin()
												}
											})
										}
									} else {
										alert(JSON.stringify(err));
									}
								});


							})
						}
					});

				} else {



				}
				break;
			case 2:
				break;
			case 3:
				break;
		}
	}

	//
	function moveLesson() {
		var data = {};
		data.method = "selectClass";
		data.request = {
			"timetableId": info.timetableId,
			"studentId": info.studentId
		}, api.showProgress();
		console.log("请假处理selectClass请求数据：" + JSON.stringify(data));
		ajaxRequest(data, function(ret, err) {
			api.hideProgress();
			if (ret) {
				if (ret.responseBody != null) {
					console.log("请假处理selectClass返回数据：" + JSON.stringify(ret.responseBody));
					var inclass = ret.responseBody.insClass;
					var timetable = ret.responseBody.timetable;
					var newclass = [];
					var newtable = {};
					var newclassid = [];
					var newtableid = {};
					for (var i = 0; i < inclass.length; i++) {
						newclass[i] = inclass[i].className;
						newclassid[i] = inclass[i].id
						var key = newclass[i];
						var list = [];
						var listid = [];
						var keyid = newclassid[i];
						var mlist = {}
						if (timetable[i].length != 0) {
							for (var j = 0; j < timetable[i].length; j++) {
								list[j] = timetable[i][j].schoolTime.substring(0, 16) + '-' + timetable[i][j].quittingTime.substring(10, 16);
								listid[j] = timetable[i][j].id;
							}
							newtable[key] = list;
							newtableid[keyid] = listid;
							mlist.classTime = list;
							mlist.classTimeid = listid;
						} else {
							newtable[key] = null;
							newtableid[keyid] = null;
						}

					}
					if (newclass != null && newclass.length > 0) {
						if (newtable[newclass[0]] == null) {
							time = '没有空闲时间';
						} else if (newtable[newclass[0]].length > 1) {
							time = newtable[newclass[0]][0];
						} else {
							time = newtable[newclass[0]]
						}
						$api.text($api.dom('#tk2'), '点击选择');
						$api.text($api.dom('#tk3'), '点击选择');
						openSelect(newclass, newtable, inclass, timetable);
					} else {
						$api.text($api.dom('#tk2'), '没有可调班级');
						$api.text($api.dom('#tk3'), '没有可调时间');
					}
				}
			} else {
				//alert(JSON.stringify(err))
			}
		})
	}

	var Cosur;
	var index
	var Cosur2;

	function openSelect(selectArray, selectTime, classID, TableID) {
		console.log("补课班级：" + selectArray + "---补课时间：" + JSON.stringify(selectTime));

		$api.addEvt($api.dom('#tk2'), 'click', function() {
			if (selectArray.length != 0) {
				api.actionSheet({
					cancelTitle: "取消",
					buttons: selectArray,
					style: {
						fontNormalColor: '#666666'
					}
				}, function(ret, err) {
					index = ret.buttonIndex;
					if (index == (selectArray.length + 1)) {} else {
						$api.text($api.dom('#tk2'), selectArray[index - 1]);
						Cosur = index - 1;
						if (selectTime[selectArray[Cosur]] != null) {
							$api.text($api.dom('#tk3'), '点击选择');
							if (isSelectTime) {
								$api.addEvt($api.dom('#tk3'), 'click', function() {
									api.actionSheet({
										cancelTitle: "取消",
										buttons: selectTime[selectArray[Cosur]],
										style: {
											fontNormalColor: '#333'
										}
									}, function(ret, err) {
										Cosur2 = ret.buttonIndex;
										if (!selectTime[selectArray[Cosur]]) {
											return;
										}
										if (Cosur2 == (selectTime[selectArray[Cosur]].length + 1)) { //捕获取消事件
										} else {
											$api.text($api.dom('#tk3'), selectTime[selectArray[Cosur]][Cosur2 - 1]);
											$api.css($api.dom('.endtab'), 'background: #ff8344;');
											$api.addEvt($api.dom('.endtab'), 'click', function() {
												api.confirm({
													title: '提示',
													msg: '申请一经确认，即时生效，确认操作？',
													buttons: ['确定', '取消']
												}, function(ret, err) {
													if (ret) {
														var index = ret.buttonIndex;
														if (index === 1) {
															//提交信息TODO
															var data = {};
															data.method = "saveNewClasstimetable";
															data.request = {
																	"id": api.pageParam.needid,
																	"teacherId": api.getPrefs({
																		sync: true,
																		key: 'userid'
																	}),
																	"newClassId": classID[index - 1].id,
																	"newClassTimetableId": TableID[index - 1][Cosur2 - 1].id,
																	"teacherOpinion": 0,
																	"leaveType": 0
																},
																api.showProgress();
															console.log("请假处理调课saveNewClasstimetable请求数据：" + JSON.stringify(data));
															ajaxRequest(data, function(ret, err) {
																api.hideProgress();
																if (ret) {
																	console.log("请假处理调课saveNewClasstimetable成功返回数据：" + JSON.stringify(ret));
																	if (ret.responseBody) {
																		alert("恭喜，提交成功！");
																		closeWin()
																	}

																} else {
																	console.log("请假处理直接销课saveNewClasstimetable失败返回数据：" + JSON.stringify(err));
																	alert("提交失败，请稍后重试！");
																	closeWin()
																}
															})
														}
													} else {
														alert(JSON.stringify(err));
													}
												});

											})
										}
									})
								});
								isSelectTime = false;
							}
						} else {
							$api.text($api.dom('#tk3'), '没有可用时间');
						}
					}
				})
			} else {}
			a = 0;
		});
	}

	function json() {
		var json = [];
		var list = {};
		list.title = tittle;
		list.name = info.studentName;
		list.tel = info.studentphone;
		list.cls = info.oldClassName;
		if (info.reason == 0) {
			list.reason = "病假";
		} else if (info.reason == 1) {
			list.reason = "事假";
		} else if (info.reason == 2) {
			list.reason = "天气原因 ";
		} else if (info.reason == 3) {
			list.reason = "其他";
		}
		list.remark = info.remark;
		list.lesson = "第" + info.oldCoursePeriod + "课时";
		list.num = info.stute;
		var states = ['待处理', '已完成', '已完成'];
		if (info.stute == 0) {
			list.suggestion = '点击选择';
			list.makeup = '点击选择';
			list.time = '点击选择';
			$api.addCls($api.domAll('.txtleft')[0], 'fontcolor');
			$api.addCls($api.domAll('.txtleft')[1], 'fontcolor');
			$api.addCls($api.domAll('.txtleft')[2], 'fontcolor');
		} else {
			//				list.suggestion = states[list.num]
			//				list.makeup = api.pageParam.newClassName;
			//				list.time = api.pageParam.createTime;
		}
		json.push(list);
		var tmpl = doT.template($api.text($api.dom("#dotTmpl")));
		$api.html($api.dom(".flex-wrap"), tmpl(json));
		$api.css($api.dom('.hicp'), "background: url(" + info.studentImg + ");background-size:100%; ");
		$api.fixStatusBar($api.dom('header'));
		//电话号码拨打电话
		$api.addEvt($api.dom('.callphone'), 'click', function() {
			if (info.studentphone.length > 0) {
				api.call({
					type: 'tel_prompt',
					number: info.studentphone
				});
			} else {}
		});
	}

	function fillDetail(ret) {
		var json = [];
		var list = {};
		list.title = "请假详情";
		list.name = ret.studentName;
		list.tel = ret.studentPhone;
		list.cls = ret.oldClassName;
		if (info.reason == 0) {
			list.reason = "病假";
		} else if (info.reason == 1) {
			list.reason = "事假";
		} else if (info.reason == 2) {
			list.reason = "天气原因 ";
		} else if (info.reason == 3) {
			list.reason = "其他";
		}
		list.remark = info.remark
		list.lesson = "第" + ret.oldCoursePeriod + "课时";
		list.num = ret.status;
		//teacherOpinion 0调课,1肖克,2保留,3拒绝
		var suggestions = ["调课", "直接销课", "保留课次", "拒绝申请"]
		list.suggestion = suggestions[ret.teacherOpinion] //states[list.num]
		if (ret.teacherOpinion == 0) { //tiaoke
			$api.css($api.dom('#maclass'), "display:block");
			$api.css($api.dom('#ticlass'), "display:block");
			list.makeup = ret.newClassName
			list.time = ret.newClassTimetableStartTime
		} else {
			$api.css($api.dom('#maclass'), "display:none");
			$api.css($api.dom('#ticlass'), "display:none");
		}
		json.push(list);
		var tmpl = doT.template($api.text($api.dom("#dotTmpl")));
		$api.html($api.dom(".flex-wrap"), tmpl(json));
		$api.css($api.dom('.hicp'), "background: url(" + info.studentImg + ");background-size:100%; ");
		$api.fixStatusBar($api.dom('header'));
		//电话号码拨打电话
		$api.addEvt($api.dom('.callphone'), 'click', function() {
			if (info.studentphone.length > 0) {
				api.call({
					type: 'tel_prompt',
					number: info.studentphone
				});
			} else {}
		});
		if (ret.teacherOpinion == 0) {
			$api.css($api.dom('#maclass'),
				'display:  display: -webkit-flex; display: flex;  display: -webkit-box;   /* 老版本语法: Safari, iOS, Android browser, older  WebKit browsers. */ display: -moz-box; /* 老版本语法: Firefox (buggy) display: -ms-flexbox;   /* 混合版本语法: IE 10 */   ');
			$api.css($api.dom('#ticlass'),
				'display:  display: -webkit-flex; display: flex;  display: -webkit-box;   /* 老版本语法: Safari, iOS, Android browser, older  WebKit browsers. */ display: -moz-box; /* 老版本语法: Firefox (buggy) display: -ms-flexbox;   /* 混合版本语法: IE 10 */   ');
		} else {
			$api.css($api.dom('#maclass'), "display:none");
			$api.css($api.dom('#ticlass'), "display:none");
		}
		$api.addCls($api.domAll(".txtleft")[2], 'fontcolor_1');
	}

	function requestLeaveDetail() {
		api.showProgress();
		var body = {
			"method": "studentLeaveInfo",
			"request": {
				"id": api.pageParam.needid
			}
		}
		ajaxRequest(body, function(ret, err) {
			api.hideProgress();
			if (ret) {
				if (ret.responseCode == 0) {
					fillDetail(ret.responseBody)
					$api.addCls($api.dom('.endtab'), 'hid');
				} else {
					alert(ret.responseMsg)
				}
			} else {
				alert(err.msg)
			}
		})

	}

	function fillDetail(ret) {
		var json = [];
		var list = {};
		list.title = "请假详情";
		list.name = ret.studentName;
		list.tel = ret.studentPhone;
		list.cls = ret.oldClassName;
		list.lesson = "第" + ret.oldCoursePeriod + "课时";
		list.num = ret.status;
		//teacherOpinion 0调课,1肖克,2保留,3拒绝
		if (info.reason == 0) {
			list.reason = "病假";
		} else if (info.reason == 1) {
			list.reason = "事假";
		} else if (info.reason == 2) {
			list.reason = "天气原因 ";
		} else if (info.reason == 3) {
			list.reason = "其他";
		}
		list.remark = info.remark
		var suggestions = ["调课", "直接销课", "保留课次", "拒绝申请"]
		list.suggestion = suggestions[ret.teacherOpinion] //states[list.num]
		if (ret.teacherOpinion == 0) { //tiaoke
			$api.css($api.dom('#maclass'), "display:block");
			$api.css($api.dom('#ticlass'), "display:block");
			list.makeup = ret.newClassName
			list.time = ret.newClassTimetableStartTime
		} else {
			$api.css($api.dom('#maclass'), "display:none");
			$api.css($api.dom('#ticlass'), "display:none");
		}
		json.push(list);
		var tmpl = doT.template($api.text($api.dom("#dotTmpl")));
		$api.html($api.dom(".flex-wrap"), tmpl(json));
		$api.css($api.dom('.hicp'), "background: url(" + info.studentImg + ");background-size:100%; ");
		$api.fixStatusBar($api.dom('header'));
		//电话号码拨打电话
		$api.addEvt($api.dom('.callphone'), 'click', function() {
			if (info.studentphone.length > 0) {
				api.call({
					type: 'tel_prompt',
					number: info.studentphone
				});
			} else {}
		});
		if (ret.teacherOpinion == 0) {
			$api.css($api.dom('#maclass'),
				'display:  display: -webkit-flex; display: flex;  display: -webkit-box;   /* 老版本语法: Safari, iOS, Android browser, older  WebKit browsers. */ display: -moz-box; /* 老版本语法: Firefox (buggy) display: -ms-flexbox;   /* 混合版本语法: IE 10 */   ');
			$api.css($api.dom('#ticlass'),
				'display:  display: -webkit-flex; display: flex;  display: -webkit-box;   /* 老版本语法: Safari, iOS, Android browser, older  WebKit browsers. */ display: -moz-box; /* 老版本语法: Firefox (buggy) display: -ms-flexbox;   /* 混合版本语法: IE 10 */   ');
		} else {
			$api.css($api.dom('#maclass'), "display:none");
			$api.css($api.dom('#ticlass'), "display:none");
		}
		$api.addCls($api.domAll(".txtleft")[2], 'fontcolor_1');
	}

	function requestLeaveDetail() {
		api.showProgress();
		var body = {
			"method": "studentLeaveInfo",
			"request": {
				"id": api.pageParam.needid
			}
		}
		ajaxRequest(body, function(ret, err) {
			api.hideProgress();
			if (ret) {
				if (ret.responseCode == 0) {
					fillDetail(ret.responseBody)
					$api.addCls($api.dom('.endtab'), 'hid');
				} else {
					alert(ret.responseMsg)
				}
			} else {
				alert(err.msg)
			}
		})

	}

	imready = function() {
		imageUrl = api.getPrefs({
			sync: true,
			key: 'imageUrl'
		});
		TimeId = [];
		tk = ["调课", "直接销课", "保留课次"];
		info = api.pageParam;
		console.log('api.pageParam信息：' + JSON.stringify(info));
		if (info.stute == 0) {
			tittle = '请假处理';
			json();
		} else {
			tittle = '请假详情';
			//json();
			$api.addCls($api.dom('.endtab'), 'hid');
			//		     	$api.css($api.dom('#maclass'),"display:block");
			//		     	$api.css($api.dom('#ticlass'),"display:block");
			requestLeaveDetail()

		}
	};
</script>

</html>
